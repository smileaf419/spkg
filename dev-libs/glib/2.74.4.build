HOMEPAGE="https://www.gtk.org/"
DESCRIPTION="The GLib library of C routines"
SRC_URI=("https://download.gnome.org/sources/glib/${PKG_VER%.*}/glib-${PKG_VER}.tar.xz")
PATCHES=("https://www.linuxfromscratch.org/patches/blfs/svn/glib-2.74.3-skip_warnings-1.patch")
LICENSE="LGPLv2.1+"
DEPS="dev-libs/elfutils dev-libs/libffi dev-libs/libpcre dev-libs/libpcre2 sys-libs/zlib"
BDEPS=""
RDEPS="app-text/docbook-xml app-text/docbook-xsl-nons"
SLOT=0

setBuildENV meson ninja

src_configure() {
	# Disable man pages till we can fix the docbook-xsl-nons package.
	configure_default -Dman=true
}

src_compile() {
	sed -i 's,--nonet,--nonet --catalogs,' build.ninja
	SGML_CATALOG_FILES=file:///etc/xml/catalog ninja
}

src_test() {
	inform " * glib tests require desktop-file-utils & shared-mime-info"
	#test_default
}

src_install() {
	install_default
	mkdir -p ${D}/usr/share/doc/glib-${PKG_VER}
	cp -r ../docs/reference/{gio,glib,gobject} ${D}/usr/share/doc/glib-${PKG_VER}
	rm -f ${D}/usr/include/glib-2.0/glib/gurifuncs.h
}
